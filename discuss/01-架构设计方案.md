# 8004scan 网站复刻 - 架构设计方案

## 1. 项目概述

8004scan 是一个 ERC-8004 AI 代理浏览器，用于探索和展示区块链上的 AI 代理信息。

### 核心功能
- 整体统计数据展示
- AI 代理列表和搜索
- 代理详情查看
- 最近活动记录
- 网络信息展示
- 深色/浅色主题切换

## 2. 技术栈

### 前端技术栈
- **框架**: Next.js 15.4（App Router）
- **UI 库**: React 19
- **类型系统**: TypeScript 5.x
- **样式**: Tailwind CSS v4
- **组件库**: shadcn/ui（可选）
- **状态管理**: React Context + Hooks
- **HTTP 客户端**: fetch API / axios
- **图标**: lucide-react

### 后端技术栈
- **语言**: Python 3.12+
- **框架**: FastAPI
- **包管理**: uv
- **数据库**: PostgreSQL 16
- **ORM**: SQLAlchemy 2.x
- **数据验证**: Pydantic v2
- **迁移工具**: Alembic
- **日志**: structlog

### 开发工具
- **代码格式化**: prettier (前端), ruff (后端)
- **代码检查**: eslint (前端), ruff (后端)
- **版本控制**: Git

## 3. 项目结构

```
8004scan/
├── frontend/                    # 前端项目
│   ├── src/
│   │   ├── app/                # Next.js App Router 页面
│   │   │   ├── page.tsx       # 首页
│   │   │   ├── agents/        # 代理列表和详情
│   │   │   ├── networks/      # 网络信息
│   │   │   └── layout.tsx     # 根布局
│   │   ├── components/         # 可复用组件
│   │   │   ├── layout/        # 布局组件
│   │   │   ├── agent/         # 代理相关组件
│   │   │   └── common/        # 通用组件
│   │   ├── lib/               # 工具库
│   │   │   ├── api/           # API 客户端
│   │   │   └── utils/         # 工具函数
│   │   ├── types/             # TypeScript 类型定义
│   │   └── styles/            # 全局样式
│   ├── public/                # 静态资源
│   ├── package.json
│   └── tsconfig.json
│
├── backend/                    # 后端项目
│   ├── src/
│   │   ├── main.py            # 应用入口（简洁）
│   │   ├── api/               # API 路由
│   │   │   ├── agents.py      # 代理相关 API
│   │   │   ├── networks.py    # 网络相关 API
│   │   │   └── stats.py       # 统计数据 API
│   │   ├── models/            # 数据库模型
│   │   ├── schemas/           # Pydantic 数据模式
│   │   ├── services/          # 业务逻辑层
│   │   ├── db/                # 数据库配置
│   │   └── core/              # 核心配置
│   ├── logs/                  # 日志目录
│   ├── .venv/                 # Python 虚拟环境
│   ├── pyproject.toml
│   └── uv.lock
│
├── scripts/                    # 运行和部署脚本
│   ├── dev-frontend.sh        # 前端开发启动
│   ├── dev-backend.sh         # 后端开发启动
│   ├── build-frontend.sh      # 前端构建
│   └── dev-all.sh             # 同时启动前后端
│
├── docs/                       # 正式文档
│   ├── API文档.md
│   └── 部署指南.md
│
└── discuss/                    # 讨论和方案
    └── 01-架构设计方案.md

```

## 4. 数据模型设计

### Agent（代理）
```python
- id: UUID
- name: str
- address: str (区块链地址)
- description: str
- reputation_score: float
- status: enum (active, inactive, validating)
- network_id: UUID
- created_at: datetime
- updated_at: datetime
```

### Network（网络）
```python
- id: UUID
- name: str
- chain_id: int
- rpc_url: str
- explorer_url: str
- created_at: datetime
```

### Activity（活动记录）
```python
- id: UUID
- agent_id: UUID
- activity_type: enum (registered, reputation_update, validation)
- description: str
- tx_hash: str (可选)
- created_at: datetime
```

### Stats（统计数据）
```python
- id: UUID
- total_agents: int
- active_agents: int
- total_networks: int
- total_activities: int
- updated_at: datetime
```

## 5. API 接口设计

### 统计数据
- `GET /api/stats` - 获取整体统计数据

### 代理相关
- `GET /api/agents` - 获取代理列表（支持分页和搜索）
- `GET /api/agents/{id}` - 获取代理详情
- `GET /api/agents/featured` - 获取精选代理

### 网络相关
- `GET /api/networks` - 获取网络列表
- `GET /api/networks/{id}` - 获取网络详情

### 活动记录
- `GET /api/activities` - 获取最近活动记录（支持分页）
- `GET /api/activities/agent/{agent_id}` - 获取特定代理的活动记录

## 6. 前端页面结构

### 主要页面
1. **首页** (`/`)
   - 整体统计数据
   - 搜索框
   - 精选代理（8个）
   - 最近活动

2. **代理列表页** (`/agents`)
   - 所有代理列表
   - 筛选和排序
   - 分页

3. **代理详情页** (`/agents/[id]`)
   - 代理完整信息
   - 活动历史
   - 相关数据

4. **网络列表页** (`/networks`)
   - 所有支持的网络
   - 网络统计信息

5. **网络详情页** (`/networks/[id]`)
   - 网络详细信息
   - 该网络上的代理列表

## 7. 开发流程

### Phase 1: 基础设施
1. 初始化前端项目
2. 初始化后端项目
3. 配置数据库
4. 编写运行脚本

### Phase 2: 后端开发
1. 实现数据模型
2. 实现 API 接口
3. 添加日志系统
4. 准备测试数据

### Phase 3: 前端开发
1. 实现页面布局和路由
2. 实现通用组件
3. 实现页面功能
4. 对接后端 API

### Phase 4: 集成和优化
1. 前后端联调
2. 性能优化
3. UI/UX 优化
4. 文档完善

## 8. 代码质量要求

### 文件大小控制
- TypeScript/Python 文件：不超过 300 行
- 每个文件夹：不超过 8 个文件

### 架构原则
- 避免僵化：保持模块解耦
- 避免冗余：复用代码逻辑
- 避免循环依赖：清晰的依赖关系
- 避免脆弱性：修改影响最小化
- 保持清晰：代码意图明确

## 9. 部署方案

### 开发环境
- 前端：`http://localhost:3000`
- 后端：`http://localhost:8000`
- 数据库：`localhost:5432`

### 生产环境（后续规划）
- 前端：Vercel / Netlify
- 后端：云服务器 + Docker
- 数据库：托管 PostgreSQL

## 10. 下一步行动

1. ✅ 完成架构设计
2. 初始化前端项目
3. 初始化后端项目
4. 开始实现核心功能
