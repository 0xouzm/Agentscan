# åå°å¼‚æ­¥åˆ†ç±»ä½¿ç”¨æŒ‡å—

## åŠŸèƒ½æ¦‚è¿°

ä¸ºäº†ä¸å½±å“ç°æœ‰åŠŸèƒ½ï¼Œ8004scan ç°åœ¨æ”¯æŒå¼‚æ­¥åå°åˆ†ç±» agentsã€‚è¯¥åŠŸèƒ½ï¼š

- âœ… **å®Œå…¨å¼‚æ­¥**ï¼šä¸é˜»å¡ä¸»æœåŠ¡ï¼Œåå°è¿è¡Œ
- âœ… **å®æ—¶è¿›åº¦**ï¼šå¯éšæ—¶æŸ¥çœ‹åˆ†ç±»è¿›åº¦
- âœ… **æ‰¹é‡å¤„ç†**ï¼šæ”¯æŒåˆ†æ‰¹å¤„ç†ï¼Œé¿å…èµ„æºå ç”¨è¿‡é«˜
- âœ… **å¯æ§åˆ¶**ï¼šå¯ä»¥å¯åŠ¨ã€æŸ¥çœ‹çŠ¶æ€ã€å–æ¶ˆä»»åŠ¡
- âœ… **è‡ªåŠ¨é™çº§**ï¼šAPI å¤±è´¥æ—¶è‡ªåŠ¨ä½¿ç”¨å…³é”®è¯åŒ¹é…

## å½“å‰çŠ¶æ€

- **æ€» Agents**: 1737
- **å·²åˆ†ç±»**: 34 (1.96%)
- **æœªåˆ†ç±»**: 1703

## ä½¿ç”¨æ–¹æ³•

### æ–¹å¼ 1: ä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰

#### 1. å¯åŠ¨åå°åˆ†ç±»ä»»åŠ¡

```bash
cd /Users/ouzm/Code/work-repo/8004scan/backend

# å¯åŠ¨åˆ†ç±»ï¼ˆå¤„ç† 100 ä¸ªï¼Œæ¯æ‰¹ 10 ä¸ªï¼‰
./classify_background.sh start 100 10

# å¯åŠ¨åˆ†ç±»ï¼ˆå¤„ç† 500 ä¸ªï¼Œæ¯æ‰¹ 20 ä¸ªï¼‰
./classify_background.sh start 500 20

# åˆ†ç±»å…¨éƒ¨ï¼ˆ1737 ä¸ªï¼Œæ¯æ‰¹ 20 ä¸ªï¼‰
./classify_background.sh start 1737 20
```

**å‚æ•°è¯´æ˜**:
- `limit`: æœ€å¤šå¤„ç†å¤šå°‘ä¸ª agent
- `batch_size`: æ¯æ‰¹å¤„ç†å¤šå°‘ä¸ªï¼ˆå»ºè®® 10-20ï¼Œé¿å… API é™æµï¼‰

#### 2. æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹å½“å‰ä»»åŠ¡è¿›åº¦
./classify_background.sh status
```

ç¤ºä¾‹è¾“å‡º:
```json
{
    "is_running": true,
    "total_agents": 100,
    "processed": 45,
    "classified": 44,
    "failed": 1,
    "progress": 45.0,
    "started_at": "2025-11-14T16:24:05.539093",
    "finished_at": null,
    "current_agent": "My AI Agent",
    "error": null
}

ä»»åŠ¡è¿è¡Œä¸­: 45/100 (45.0%)
```

#### 3. å–æ¶ˆä»»åŠ¡

```bash
# å–æ¶ˆæ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ï¼ˆå½“å‰ agent å¤„ç†å®Œæˆååœæ­¢ï¼‰
./classify_background.sh cancel
```

### æ–¹å¼ 2: ç›´æ¥è°ƒç”¨ API

#### 1. å¯åŠ¨åå°åˆ†ç±»

```bash
# å¤„ç† 100 ä¸ªï¼Œæ¯æ‰¹ 10 ä¸ª
curl -X POST "http://localhost:8000/api/agents/classify-background?limit=100&batch_size=10"

# å¤„ç†å…¨éƒ¨ï¼Œæ¯æ‰¹ 20 ä¸ª
curl -X POST "http://localhost:8000/api/agents/classify-background?limit=1737&batch_size=20"
```

#### 2. æŸ¥çœ‹çŠ¶æ€

```bash
curl http://localhost:8000/api/agents/classify-background/status
```

#### 3. å–æ¶ˆä»»åŠ¡

```bash
curl -X POST http://localhost:8000/api/agents/classify-background/cancel
```

## æ€§èƒ½å‚æ•°å»ºè®®

### å°è§„æ¨¡æµ‹è¯•ï¼ˆ< 50 ä¸ªï¼‰
```bash
./classify_background.sh start 20 5
```
- **ç”¨é€”**ï¼šæµ‹è¯•åˆ†ç±»æ•ˆæœ
- **æ—¶é—´**ï¼šçº¦ 2-3 åˆ†é’Ÿ

### ä¸­ç­‰è§„æ¨¡ï¼ˆ100-500 ä¸ªï¼‰
```bash
./classify_background.sh start 200 10
```
- **ç”¨é€”**ï¼šå¸¸è§„æ‰¹é‡åˆ†ç±»
- **æ—¶é—´**ï¼šçº¦ 15-20 åˆ†é’Ÿ

### å¤§è§„æ¨¡ï¼ˆå…¨éƒ¨ 1737 ä¸ªï¼‰
```bash
./classify_background.sh start 1737 20
```
- **ç”¨é€”**ï¼šä¸€æ¬¡æ€§å¤„ç†æ‰€æœ‰ agents
- **æ—¶é—´**ï¼šçº¦ 2-3 å°æ—¶
- **å»ºè®®**ï¼šåœ¨æœåŠ¡å™¨ä¸Šåå°è¿è¡Œï¼Œå®šæœŸæŸ¥çœ‹è¿›åº¦

## æ‰¹æ¬¡å¤„ç†æœºåˆ¶

```
ä»»åŠ¡å¯åŠ¨
  â†“
è·å–æœªåˆ†ç±» agentsï¼ˆæŒ‰ limit é™åˆ¶ï¼‰
  â†“
åˆ†æ‰¹å¤„ç†ï¼ˆæ¯æ‰¹ batch_size ä¸ªï¼‰
  â”œâ”€â”€ æ‰¹æ¬¡ 1: å¤„ç† 10 ä¸ª agents
  â”œâ”€â”€ æ‰¹æ¬¡ 2: å¤„ç† 10 ä¸ª agents
  â”œâ”€â”€ ...
  â””â”€â”€ æ‰¹æ¬¡ N: å¤„ç†å‰©ä½™ agents
  â†“
æ¯æ‰¹ä¹‹é—´ä¼‘æ¯ 1 ç§’ï¼ˆé¿å… API é™æµï¼‰
  â†“
ä»»åŠ¡å®Œæˆ
```

**ç‰¹ç‚¹**:
- æ¯ä¸ª agent å¤„ç†åè®©å‡ºæ§åˆ¶æƒï¼ˆé¿å…é˜»å¡ï¼‰
- æ‰¹æ¬¡é—´è‡ªåŠ¨ä¼‘æ¯ï¼ˆé¿å… API é™æµï¼‰
- æ”¯æŒå®æ—¶è¿›åº¦è¿½è¸ª

## ç›‘æ§ä»»åŠ¡è¿›åº¦

### æ–¹æ³• 1: å®šæœŸæŸ¥è¯¢çŠ¶æ€

```bash
# æ¯ 30 ç§’æŸ¥çœ‹ä¸€æ¬¡çŠ¶æ€
watch -n 30 ./classify_background.sh status
```

### æ–¹æ³• 2: æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f logs/app.log | grep classification
```

æ—¥å¿—ç¤ºä¾‹:
```
2025-11-14 16:24:05 [info] background_classification_started total=20 limit=20 batch_size=5
2025-11-14 16:24:10 [info] agent_classified agent_id=xxx skills_count=5 domains_count=3 progress=1/20
2025-11-14 16:26:13 [info] background_classification_finished total=20 classified=20 failed=0 duration_seconds=128
```

### æ–¹æ³• 3: æŸ¥çœ‹æ•°æ®åº“ç»Ÿè®¡

```bash
uv run python check_classified.py
```

è¾“å‡º:
```
ğŸ“Š æ•°æ®åº“ç»Ÿè®¡:
  æ€» Agents: 1737
  âœ… å·²åˆ†ç±»: 34
  âŒ æœªåˆ†ç±»: 1703
  è¿›åº¦: 1.96%
```

## å¸¸è§é—®é¢˜

### Q1: ä»»åŠ¡å¯ä»¥ä¸­é€”å–æ¶ˆå—ï¼Ÿ
**A**: å¯ä»¥ï¼ä½¿ç”¨ `./classify_background.sh cancel` å–æ¶ˆï¼Œä»»åŠ¡ä¼šåœ¨å½“å‰ agent å¤„ç†å®Œæˆååœæ­¢ã€‚

### Q2: ä»»åŠ¡å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ
**A**:
1. æ£€æŸ¥ API key æ˜¯å¦æœ‰æ•ˆï¼ˆDeepSeek/OpenAI ç­‰ï¼‰
2. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ç¡®è®¤é”™è¯¯åŸå› 
3. å¦‚æœæ˜¯å•ä¸ª agent å¤±è´¥ï¼Œä»»åŠ¡ä¼šç»§ç»­å¤„ç†å…¶ä»– agents
4. å¦‚æœæ˜¯ç³»ç»Ÿé”™è¯¯ï¼Œä»»åŠ¡ä¼šæ ‡è®°ä¸ºå¤±è´¥å¹¶åœæ­¢

### Q3: å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªåˆ†ç±»ä»»åŠ¡å—ï¼Ÿ
**A**: ä¸å¯ä»¥ã€‚åŒä¸€æ—¶é—´åªèƒ½è¿è¡Œä¸€ä¸ªåå°åˆ†ç±»ä»»åŠ¡ã€‚å¦‚æœå°è¯•å¯åŠ¨ç¬¬äºŒä¸ªï¼Œä¼šæ”¶åˆ° "already_running" æç¤ºã€‚

### Q4: ä»»åŠ¡è¿è¡ŒæœŸé—´å¯ä»¥é‡å¯æœåŠ¡å™¨å—ï¼Ÿ
**A**: ä¸å»ºè®®ã€‚é‡å¯ä¼šä¸­æ–­ä»»åŠ¡ï¼Œå·²åˆ†ç±»çš„ agents ä¼šä¿å­˜åˆ°æ•°æ®åº“ï¼Œä½†æœªå®Œæˆçš„éƒ¨åˆ†éœ€è¦é‡æ–°å¯åŠ¨ã€‚

### Q5: åˆ†ç±»é€Ÿåº¦å¤ªæ…¢æ€ä¹ˆåŠï¼Ÿ
**A**:
1. å¢åŠ  `batch_size`ï¼ˆä» 10 æé«˜åˆ° 20ï¼‰
2. ç¡®è®¤ç½‘ç»œè¿æ¥ç¨³å®š
3. æ£€æŸ¥ LLM API å“åº”æ—¶é—´

### Q6: å¦‚ä½•ç¡®è®¤ agents å·²è¢«åˆ†ç±»ï¼Ÿ
**A**:
1. æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€ä¸­çš„ `classified` è®¡æ•°
2. è¿è¡Œ `check_classified.py` æŸ¥çœ‹æ•°æ®åº“ç»Ÿè®¡
3. åœ¨å‰ç«¯æŸ¥çœ‹ agent è¯¦æƒ…ï¼Œç¡®è®¤ skills å’Œ domains æ ‡ç­¾

## æˆæœ¬ä¼°ç®—ï¼ˆDeepSeekï¼‰

- **å•æ¬¡åˆ†ç±»æˆæœ¬**: ~$0.0003
- **100 ä¸ª agents**: ~$0.03
- **500 ä¸ª agents**: ~$0.15
- **1737 ä¸ª agents**: ~$0.52

**æ€»æˆæœ¬**: ä¸åˆ° $1ï¼ˆæä½ï¼‰

## æ¨èæµç¨‹

### é¦–æ¬¡ä½¿ç”¨ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰

```bash
# 1. SSH åˆ°æœåŠ¡å™¨
ssh user@your-server

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd /path/to/8004scan/backend

# 3. å¯åŠ¨å°è§„æ¨¡æµ‹è¯•ï¼ˆ20 ä¸ªï¼‰
./classify_background.sh start 20 5

# 4. æŸ¥çœ‹çŠ¶æ€ç¡®è®¤æ­£å¸¸
./classify_background.sh status

# 5. ç¡®è®¤æ— è¯¯åï¼Œå¯åŠ¨å¤§è§„æ¨¡åˆ†ç±»
./classify_background.sh start 500 20

# 6. ä½¿ç”¨ tmux/screen ä¿æŒä¼šè¯ï¼ˆå¯é€‰ï¼‰
screen -S classification
./classify_background.sh start 1737 20
# Ctrl+A, D åˆ†ç¦»ä¼šè¯

# 7. å®šæœŸæŸ¥çœ‹è¿›åº¦
watch -n 60 ./classify_background.sh status
```

### ç›‘æ§ä»»åŠ¡

```bash
# æ–¹å¼ 1: å®æ—¶çŠ¶æ€
watch -n 30 ./classify_background.sh status

# æ–¹å¼ 2: æŸ¥çœ‹æ—¥å¿—
tail -f logs/app.log | grep -E "(classification|classified)"

# æ–¹å¼ 3: æ•°æ®åº“ç»Ÿè®¡
uv run python check_classified.py
```

## API ç«¯ç‚¹æ€»ç»“

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/agents/classify-background` | POST | å¯åŠ¨åå°åˆ†ç±»ä»»åŠ¡ |
| `/api/agents/classify-background/status` | GET | æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€ |
| `/api/agents/classify-background/cancel` | POST | å–æ¶ˆä»»åŠ¡ |
| `/api/agents/{id}/classify` | POST | æ‰‹åŠ¨åˆ†ç±»å•ä¸ª agent |
| `/api/agents/classify-all` | POST | åŒæ­¥æ‰¹é‡åˆ†ç±»ï¼ˆé˜»å¡å¼ï¼‰|

## æŠ€æœ¯å®ç°

- **åå°ä»»åŠ¡**: ä½¿ç”¨ FastAPI `BackgroundTasks`
- **æ‰¹é‡å¤„ç†**: æ¯æ‰¹ `batch_size` ä¸ªï¼Œæ‰¹æ¬¡é—´ä¼‘æ¯ 1 ç§’
- **è¿›åº¦è¿½è¸ª**: å®æ—¶æ›´æ–° `BackgroundClassificationTask` çŠ¶æ€
- **å¼‚æ­¥æ‰§è¡Œ**: ä¸é˜»å¡ä¸»æœåŠ¡ï¼Œæ”¯æŒå¹¶å‘è¯·æ±‚
- **é”™è¯¯å¤„ç†**: å•ä¸ªå¤±è´¥ä¸å½±å“æ•´ä½“ï¼Œè‡ªåŠ¨é™çº§åˆ°å…³é”®è¯åŒ¹é…

## æ³¨æ„äº‹é¡¹

1. âš ï¸ **æœåŠ¡å™¨è¿è¡Œ**: å»ºè®®åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œå¤§è§„æ¨¡ä»»åŠ¡ï¼Œè€Œä¸æ˜¯æœ¬åœ°
2. âš ï¸ **API é™æµ**: DeepSeek æœ‰å¹¶å‘é™åˆ¶ï¼Œ`batch_size` ä¸è¦è®¾ç½®è¿‡å¤§
3. âš ï¸ **æ•°æ®åº“é”**: SQLite åœ¨é«˜å¹¶å‘ä¸‹å¯èƒ½æœ‰é”é—®é¢˜ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ PostgreSQL
4. âš ï¸ **ä¼šè¯ä¿æŒ**: é•¿æ—¶é—´ä»»åŠ¡å»ºè®®ä½¿ç”¨ `screen` æˆ– `tmux` ä¿æŒä¼šè¯
5. âœ… **æ–° agents è‡ªåŠ¨åˆ†ç±»**: åŒºå—é“¾åŒæ­¥æ—¶æ–°æ³¨å†Œçš„ agents ä¼šè‡ªåŠ¨åˆ†ç±»

## ä¸‹ä¸€æ­¥

åˆ†ç±»å®Œæˆåï¼š
1. åœ¨å‰ç«¯æŸ¥çœ‹ agents çš„ skills å’Œ domains æ ‡ç­¾
2. ä½¿ç”¨ç­›é€‰åŠŸèƒ½æŒ‰ skills/domains æŸ¥æ‰¾ agents
3. æŸ¥çœ‹ agent è¯¦æƒ…é¡µçš„å®Œæ•´ OASF åˆ†ç±»ä¿¡æ¯

---

**æ›´æ–°æ—¶é—´**: 2025-11-14
**ç‰ˆæœ¬**: v1.0
